\documentclass{article}

% packages
\usepackage[a4paper, margin=2.2cm]{geometry}
\usepackage{multicol}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{minted}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{parskip}
\usepackage{amsmath}
\usepackage{xcolor}
\usepackage[justification=centering, margin=1.6cm]{caption}
\usepackage{graphics}

\pgfplotsset{compat=1.16}

\newlength\figurewidth
\newlength\figureheight
\setlength\figurewidth{0.4\textwidth}
\setlength\figureheight{0.4\textwidth}

\begin{document}

    \begin{titlepage}
        \begin{center}
            \vspace*{2cm}
            
            {\huge \textbf{xCore-200 Cellular Automaton Farm}}
            
            \vspace{0.5cm}
            
            {\Large COMS20001 Concurrent Computing CW1}
            
            \vspace{0.5cm}
            
            {\large Team 6}
            
            \vspace{1cm}
            
            \hspace*{1cm} {\Large \textbf{Ruairi Fox}} \hfill {\Large \textbf{Liam Dalgarno}} \hspace*{1cm} \\~\\[-0.5em]
            \hspace*{1cm} MEng. Computer Science \hfill MEng. Computer Science  \hspace*{1cm} \\~\\[-1em]
            \hspace*{1cm} rf17160@bristol.ac.uk  \hfill ld17285@bristol.ac.uk  \hspace*{1cm} 
            
            \vspace{1cm}
            
            {\large \today}
        \end{center}
    \end{titlepage}

    \section{Functionality and Design}
    1 Page Max: Outline what functionality you have implemented, which problems you have solved with your implementation and how your program is designed to solve the problems efficiently and effectively
    \pagebreak

    \section{Tests and Experiments}
    
    We tested our system in multiple ways, such as:
    
    \begin{itemize}
        \setlength\itemsep{-0.2\baselineskip}
        \item Comparing two iterations of a \verb|32x32| image to another implementation of the Game of Life. (Figure \ref{fig:test32})
        \item Examining some sample generations of a \verb|1024x1024| image starting from a straight line. (Figure \ref{fig:test1024})
        \item Varying the worker count and image size. (Section \ref{workercount})
        \item Changing the distribution of workers across the tiles. (Section \ref{workerdistribution})
        \item Comparing asynchronous channels with synchronous channels. (Section \ref{asyncchannels})
    \end{itemize}
    
    \begin{figure}[h]
        \begin{center}
            \includegraphics[width=0.15\textwidth]{test32.png}
            \includegraphics[width=0.15\textwidth]{testout32-1.png}
            \includegraphics[width=0.15\textwidth]{testout32-2.png}
            \includegraphics[width=0.15\textwidth]{verify32.png}
            \includegraphics[width=0.15\textwidth]{verify32-1.png}
            \includegraphics[width=0.15\textwidth]{verify32-2.png}
            \caption{State following 2 iterations of a \texttt{32x32} image. \\ Left: our system; Right: \texttt{https://bitstorm.org/gameoflife/}}
            \label{fig:test32}
        \end{center}
    \end{figure}

    \begin{figure}[h]
        \begin{center}
            \includegraphics[width=0.2\textwidth]{test1024.png}
            \includegraphics[width=0.2\textwidth]{testout1024-1.png}
            \includegraphics[width=0.2\textwidth]{testout1024-2.png}
            \includegraphics[width=0.2\textwidth]{testout1024-3.png}
            \caption{Example generations of a \texttt{1024x1024} image, beginning from a straight line.}
            \label{fig:test1024}
        \end{center}
    \end{figure}
    
    \subsection{Worker Count} \label{workercount}

    \begin{figure}[h]
        \begin{center}
            \input{table.tex}
            \caption{The effect of increasing worker count and size of image on Average Generation Time.}
            \label{fig:agt}
        \end{center}
    \end{figure}

    \begin{figure}[h]
        \begin{center}
            \input{agtplot.tex}
            \caption{Log plot of Average Generation Time vs. Worker Count.}
            \label{fig:agtplot}
        \end{center}
    \end{figure}

    We can measure the processing speed by the AGT (Average Generation Time). From Figure \ref{fig:agt} it's clear that increasing the number of workers is effective at reducing the AGT, although only up to a point. Regardless of worker count, the AGT for \verb|64x64| and \verb|32x32| remains at 11.64, and the AGT for \verb|128x128| with 8 workers is also 11.64. This implies that there is a bottleneck in our system, either fundamentally by the processor speed or by a design choice of ours.

    However for the larger images, doubling the worker count halves the AGT, which implies that increasing the workers gives a \textit{linear} speed up, and this is reflected by the straight lines in Figure \ref{fig:agtplot}. Furthermore, increasing the image size by a factor of 4 also increases the AGT by a factor of 4; this is expected since an $n$-fold increase in the number of cells is an $n$-fold increase in the amount of work. A nice consequence of this behaviour is that the AGT of an image with $n$ cells and $m$ workers is approximately the same as the AGT of an image with $4n$ cells and $4m$ workers (e.g. the AGT of \verb|128x128| with 2 workers is approximately equal to the AGT of \verb|256x256| with 8 workers).

    \subsection{Worker Distribution} \label{workerdistribution}

    In the \verb|xCore-200| there are \textbf{hard} and \textbf{soft} channels, where hard channels are across physical tiles, and soft channels are between individual threads on a tile. Hard channels will have higher latency since the data must travel a larger distance in comparison to a soft channel. However, using more soft channels means that a single tile is doing more processing, so it may in fact be more efficient to split the work across both tiles to utilise both cores.

    In our experiment we tested \verb|256x256| and \verb|512x512| since they're quick to test while still being large enough to be affected by optimisations.

    \begin{figure}[h]
        \begin{center}
            \input{hardsoftchannels.tex}
            \caption{The effect of varying the communication between the distributor and workers.}
            \label{fig:hardsoftchannels}
        \end{center}
    \end{figure}

    \subsection{Asynchronous Channels} \label{asyncchannels}

    \pagebreak

    % ?? is a placeholder for a future citation :)
    \section{Critical Analysis} \label{analysis}

    % i've done this wrong :)
\end{document}